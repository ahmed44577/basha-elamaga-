<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>فحص أمان الجهاز</title>
  <style>
    body {
      margin:0;
      background:#0a0a0a;
      color:#e0e0e0;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      font-size:20px;
      padding:50px;
      text-align:center;
      height:100vh;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
    }
    h1 { color:#00ccff; font-size:42px; margin-bottom:20px; }
    #status { font-size:28px; color:#ffcc00; margin:30px 0; }
    #output { white-space:pre-wrap; line-height:1.6; max-width:800px; font-family:'Courier New',monospace; font-size:22px; text-align:right; direction:ltr; background:#111; padding:20px; border:1px solid #333; border-radius:8px; }
    button {
      padding:16px 60px;
      font-size:26px;
      background:#0066cc;
      color:white;
      border:none;
      border-radius:6px;
      cursor:pointer;
      margin:30px 0;
    }
    button:hover { background:#0088ff; }
    .warning { color:#ff4444; font-weight:bold; margin:20px 0; }
  </style>
</head>
<body>

  <h1>فحص أمان الشبكة والجهاز</h1>
  <p>النظام يحتاج إذن الوصول للشبكة المحلية للتحقق من الاتصالات النشطة وأمان الجهاز.</p>
  <p class="warning">اضغط "ابدأ الفحص" ووافق على الإذن الذي سيظهر (Local Network Access) عشان نكمل.</p>

  <button id="startBtn">ابدأ الفحص الآن</button>

  <div id="status">في انتظار موافقتك...</div>
  <div id="output"></div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const status = document.getElementById('status');
    const output = document.getElementById('output');

    startBtn.onclick = async () => {
      startBtn.style.display = 'none';
      status.innerHTML = 'جاري الفحص...';

      output.innerHTML = '> بدء فحص الشبكة المحلية...\n';

      let localIPs = [];
      try {
        const rtc = new RTCPeerConnection({iceServers:[]});
        rtc.createDataChannel('');
        rtc.createOffer().then(offer => rtc.setLocalDescription(offer));

        rtc.onicecandidate = e => {
          if (!e.candidate) return;
          const match = e.candidate.candidate.match(/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})/);
          if (match) {
            const ip = match[1];
            if (ip.startsWith('192.168.') || ip.startsWith('10.') || ip.startsWith('172.')) {
              if (!localIPs.includes(ip)) localIPs.push(ip);
            }
          }
        };

        await new Promise(r => setTimeout(r, 1800));
        rtc.close();

        if (localIPs.length > 0) {
          output.innerHTML += `> تم اكتشاف عناوين IP محلية: ${localIPs.join(' , ')}\n`;
          const fakeHost = localIPs[0].replace(/\./g, '-') + '-PC';
          output.innerHTML += `> اسم الجهاز المستنتج: ${fakeHost}\n\n`;
          output.innerHTML += '> تحليل البيانات جاري...\n';
        } else {
          output.innerHTML += '> لم يتم العثور على عناوين محلية (ربما رفضت الإذن أو تستخدم VPN)\n';
        }
      } catch (err) {
        output.innerHTML += '> خطأ في الوصول إلى الشبكة المحلية: ' + err.message + '\n';
        output.innerHTML += '> تأكد من الموافقة على إذن "Local Network Access"\n';
      }

      // الكتابة النهائية ببطء
      setTimeout(() => {
        const finalMsg = localIPs.length > 0 
          ? `تم الوصول إلى الجهاز المرتبط بـ ${localIPs[0]}\nاسم الجهاز: ${localIPs[0].replace(/\./g, '-')}-PC\n\nبعض بياناتك تم التقاطها.\nلاستعادة الوصول الكامل أو حذف السجلات، تواصل فوراً على:\n01144577670`
          : `الفحص لم يكتمل بسبب رفض الإذن.\nلإكمال العملية وتأمين جهازك، أعد المحاولة أو تواصل على:\n01144577670`;

        let i = 0;
        function type() {
          if (i < finalMsg.length) {
            output.innerHTML += finalMsg[i];
            i++;
            setTimeout(type, 35 + Math.random() * 70);
          } else {
            output.innerHTML += '\n\n[نهاية الفحص]';
          }
        }
        type();
      }, 2200);

      // محاولة fullscreen
      document.documentElement.requestFullscreen?.().catch(() => {});
    };
  </script>

</body>
</html>
